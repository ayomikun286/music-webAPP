<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="musicList"></div>

    <div class="control">
      <button id="play">^</button>
      <audio src="" id="audio"></audio>
    </div>

    <script>
      const musicIMG = [
        { name: "music 1", url: "music/kooko.mp3" },
        { name: "music 2", url: "music/mofti.mp3" },
      ];

      let currentIndex = 0;

      const musicList = document.getElementById("musicList");
      musicList.innerHTML = "";
      musicIMG.forEach((songs) => {
        const tracks = document.createElement("div");
        tracks.classList.add("tracks");

        tracks.innerHTML = `
            
                <h1>${songs.name}</h1>

                <button class="songsBtn" data-src="${songs.url}">play</button>
            
            `;

        musicList.appendChild(tracks);
      });

      function playsongs() {
        const eachBTN = document.querySelectorAll(".songsBtn");

        const audio = document.getElementById("audio");
        eachBTN.forEach((btn , index) => {
          btn.addEventListener("click", () => {
            const url = btn.getAttribute("data-src");
            currentIndex = index;
            audio.src = url;
            audio.play();
          });
        });
      }
      playsongs();

        function playBtn(){

          const play = document.getElementById('play');
          const audio = document.getElementById('audio');

          play.addEventListener('click', ()=>{

              if(audio.paused){
                   audio.play();
                   play.textContent = "~"
              }else{
                  audio.pause();
                  play.textContent = "^"
              }

          });

        }
        playBtn();


        function playNextSongOnArray(){
      const audioAll = document.getElementById('audio');
             audioAll.src = musicIMG[currentIndex].url;
            currentIndex++;

            

        }
        playNextSongOnArray();






        function progressBar() {
    const progressBar = document.querySelector('.progress-bar');
    const probar = document.getElementById('proBar');
    const audio = document.getElementById('audio');
    const durationEnd = document.getElementById('durationEnd');
    const durationStart = document.getElementById('durationStart');

    // ✅ Load total duration SAFELY when song loads
    audio.addEventListener('loadedmetadata', () => {
        const totalMin = Math.floor(audio.duration / 60);
        const totalSec = Math.floor(audio.duration % 60);

        durationEnd.textContent = `${totalMin}:${totalSec < 10 ? '0' : ''}${totalSec}`;
    });

    // ✅ Update progress + current time
    audio.addEventListener('timeupdate', () => {
        if (isNaN(audio.duration)) return; // ✅ Stops NaN bug

        const progressParcent = (audio.currentTime / audio.duration) * 100;
        probar.style.width = `${progressParcent}%`;

        const currentMin = Math.floor(audio.currentTime / 60);
        const currentSec = Math.floor(audio.currentTime % 60);

        durationStart.textContent = `${currentMin}:${currentSec < 10 ? '0' : ''}${currentSec}`;
    });
}

progressBar();

    </script>
  </body>
</html>
